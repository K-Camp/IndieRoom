<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-primary text-white">
          <h3><%= @post.post_title %></h3>
        </div>

        <div class="card-body">
          <p><strong>投稿者:</strong> <%= link_to @post.user.user_name, public_user_path(@post.user) %></p>
          <p><strong>作成日:</strong> <%= @post.created_at.strftime("%Y/%m/%d %H:%M") %></p>
          <hr>
          <p><%= simple_format(@post.content) %></p>

          <% if @post.game.game_image.attached? %>
            <div class="mt-3 text-center">
              <%= image_tag @post.game.game_image, size: "300x300", class: "img-fluid rounded", style: "max-height: 400px;" %>
            </div>
          <% end %>
        </div>

        <div class="card-footer text-end">
          <!-- ログインユーザが投稿主の場合 -->
          <% if user_signed_in? && current_user == @post.user %>
            <%= link_to edit_public_post_path(@post), class: "btn btn-outline-primary mr-2" do %>
              <i class="fas fa-edit mr-1"></i> 編集
            <% end %>

            <%= link_to public_post_path(@post), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-outline-danger mr-2" do %>
              <i class="fas fa-trash-alt mr-1"></i> 削除
            <% end %>

            <%= link_to "戻る", request.referer || public_root_path, class: "btn btn-secondary" %>

          <!-- ログインユーザが投稿主以外の場合 -->
          <% else %>
            <!-- request.refererは直前に開いていたページ戻る、直前に何も開いていない場合はtopページに戻る -->
            <%= link_to "戻る", request.referer || public_root_path, class: "btn btn-secondary" %>
          <% end %>
        </div>
      </div>

      <h3>コメント一覧</h3>

      <% @post.comments.each do |comment| %>
        <p>
          <strong><%= comment.user.user_name %>:</strong>
          <%= comment.comment_text %>

          <% if comment.user == current_user %>
            <%= link_to "削除", public_post_comment_path(@post, comment),
                method: :delete,
                data: { confirm: "削除しますか？" } %>
          <% end %>
        </p>
      <% end %>

      <hr>

      <h3>コメントする</h3>

      <%= form_with(scope: :comment, url: public_post_comments_path(@post), local: true) do |f| %>
        <%= f.text_area :comment_text, row: 3, class: "form-control mb-2" %>
        <%= f.submit "投稿する",class: "btn btn-primary" %>
      <% end %>

    </div>
  </div>
</div>
